<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="en">
<head>
    <meta charset="UTF-8" />
    <title>TripGo - Book Buses</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet" />
</head>
<body class="bg-gray-100">
<header class="bg-blue-600 text-white p-4">
    <div class="container mx-auto flex justify-between items-center">
        <h1 class="text-2xl font-bold">TripGo</h1>

        <!-- User Info / Auth Buttons -->
        <div id="authSection">
            <span id="welcomeMessage" class="hidden mr-4"></span>
            <a id="loginLink" href="/api/v1/login" class="mr-4">Login</a>
            <a id="signupLink" href="/api/v1/signup" class="mr-2">Signup</a>
            <button id="logoutBtn" class="hidden bg-red-500 px-3 py-1 rounded" onclick="logout()">Logout</button>
        </div>
    </div>
</header>

<main class="container mx-auto p-6">
    <h2 class="text-3xl font-bold mb-6">Search Buses</h2>
    <form class="grid grid-cols-1 md:grid-cols-4 gap-4">
        <input type="text" placeholder="From" class="p-3 border rounded" />
        <input type="text" placeholder="To" class="p-3 border rounded" />
        <input type="date" class="p-3 border rounded" />
        <button type="submit" class="bg-blue-600 text-white p-3 rounded">Search</button>
    </form>
</main>

<!-- Auto-inject JWT + Check Login Status -->
<script>
    // Auto-inject JWT in all fetch() calls
    const originalFetch = window.fetch;
    window.fetch = function(...args) {
      const jwt = localStorage.getItem('jwt');
      if (jwt && args[1]) {
        args[1].headers = args[1].headers || {};
        args[1].headers['Authorization'] = `Bearer ${jwt}`;
      }
      return originalFetch(...args);
    };

    // Check login status on page load
    window.onload = function() {
      const jwt = localStorage.getItem('jwt');
      const userId = localStorage.getItem('userId');

      if (jwt && userId) {
        // Logged in
        document.getElementById('loginLink').classList.add('hidden');
        document.getElementById('signupLink').classList.add('hidden');
        document.getElementById('logoutBtn').classList.remove('hidden');
        document.getElementById('welcomeMessage').textContent = `Hello, User #${userId}`;
        document.getElementById('welcomeMessage').classList.remove('hidden');
      } else {
        // Not logged in
        document.getElementById('loginLink').classList.remove('hidden');
        document.getElementById('signupLink').classList.remove('hidden');
        document.getElementById('logoutBtn').classList.add('hidden');
        document.getElementById('welcomeMessage').textContent = `Hello, ${result.username}`;
      }
    };

    // Logout function
    function logout() {
      localStorage.removeItem('jwt');
      localStorage.removeItem('userId');
      localStorage.removeItem('username');
      window.location.href = '/api/v1/login';
    }
</script>
</body>
</html>